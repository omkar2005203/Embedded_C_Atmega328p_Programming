/******************************************************************************
* File Name: wiper.h
* Description: This file contains function Prototypes of GPIO.c
* Tool-Chain: AVR GCC
*
* Modification History:
* Created by: Omkar Rane 2005203 V1.0 27/Jul/15
* Description: V1.0
*
******************************************************************************/
/******************************************************************************
* Includes
******************************************************************************/
#include"Wiper.h"
/******************************************************************************
* Defines and data types
******************************************************************************/
/******************************************************************************
* Global variables
******************************************************************************/
extern volatile uint8_t isr_0;
extern volatile uint8_t isr_1;
extern volatile uint8_t timer_isr;

/******************************************************************************
*
******************************************************************************/
void standby_mode()
{
    GPIOPinWrite(PD6,LOW);
    ADCSRA &=~ (1 << ADSC);
}

void manual_mode()
{
    ADCSRA &=~ (1 << ADSC);
    OCR0A=127;
}

void auto_mode()
{
    adc_init();
    if(timer_isr==1)
    {
        timer_isr=0;
        uint16_t x=adc_read();
        if(x<=50&&x>0)
        {
            OCR0A=0;
        }
        else if(x>50&&x<=200)
        {
            OCR0A=63;
        }
        else if(x>200&&x<=500)
        {
            OCR0A=127;
        }
        else if(x>500&&x<=1000)
        {
            OCR0A=190;
        }
        else if(x>1000)
        {
            OCR0A=254;
        }
    }
}

void app_mode()
{
    if(isr_1==1&&isr_0==1)
    {
        auto_mode();
    }
    else if(isr_1==0&&isr_0==1)
    {
        manual_mode();
    }
    else
    {
        standby_mode();
    }
}

/******************************************************************************
* End of File
******************************************************************************/






