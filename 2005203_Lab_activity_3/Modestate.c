/******************************************************************************
* File Name: ModeState.c
* Description: This file contains API definitions for Mode state functionality
* Tool-Chain: AVR GCC
*
* Modification History:
* Created by: Omkar Rane 2005203 V1.0 25/Sep/2020
* Description: V1.0
******************************************************************************/
/******************************************************************************
* Includes
******************************************************************************/
#include"Modestate.h"
/******************************************************************************
* Defines and data types
******************************************************************************/
/******************************************************************************
* Global variables
******************************************************************************/
extern volatile uint8_t isr_0;
extern volatile uint8_t isr_1;
extern float freq;
extern float cycle;
extern volatile float duty_cycle;

extern volatile int time_on,time_off;

/******************************************************************************
* Static variables
******************************************************************************/
/******************************************************************************
* Internal function prototypes
******************************************************************************/
/******************************************************************************
* Public functions definitions
******************************************************************************/
/******************************************************************************
* Name: standby() and modestate()
* Description: Configures the mode of standby and modestate
* Arguments: NA
* Returns: None
******************************************************************************/
/******************************************************************************
* Internal functions
******************************************************************************/
void standby()
{
    TIMSK0|=(1<<TOIE0);
}

void appmode()
{
    TIMSK0&=~(1<<TOIE0);
    GPIOPinWrite(PD7,LOW);
    PORTD&=~(1<<PD5);
    cycle=1000/freq;
    if(isr_0==1&&isr_1==0)
    {
        isr_0=0;
        if(duty_cycle!=1)
        {
            duty_cycle+=0.1;
        }
        else
        {
            duty_cycle=1;
        }
    }
    else if(isr_1==1&&isr_0==0)
    {
        isr_1=0;
        if(duty_cycle!=0)
        {
            duty_cycle-=0.1;
        }
    }
    time_on=duty_cycle*cycle;
    time_off=cycle-time_on;
    GPIOPinWrite(PC4,HIGH);
    _delay_ms(time_on);
    GPIOPinWrite(PC4,LOW);
    _delay_ms(time_off);
}

/******************************************************************************
* Name:
* Description:
******************************************************************************/
/******************************************************************************
/******************************************************************************
* End of File
******************************************************************************/



